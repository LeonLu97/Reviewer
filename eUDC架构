
			目  录
1	产品概述	6
1.1	名称、型号、版本、保密代号	6
1.2	业务简述	6
1.3	组网与设备独立性	6
1.3.1	逻辑组网	6
1.3.2	主备和异地容灾组网	6
2	产品功能、性能	9
2.1	功能特性	9
2.2	系统对外接口	9
3	遵循的标准及主要通信协议	13
3.1	协议处理原则	13
3.2	网络兼容性处理	13
4	平台及配置简介（钟卫）	14
4.1	硬件平台简介	14
4.2	软件平台介绍	14
4.3	部署策略	14
5	系统总体结构（钟卫）	15
5.1	顶层逻辑架构	15
5.2	子系统间接口设计	16
5.3	三面隔离部署	16
6	系统部署架构（钟卫）	17
6.1	子系统结构设计	17
6.2	三栈解决方案设计	17
6.2.1	Witen解决方案	17
6.2.2	BtrunC解决方案	18
6.2.3	3GPP解决方案	19
6.3	进程部署	20
6.4	负荷分担部署	21
7	子系统设计分析（根据钟卫的总体设计，修正下面的子系统章节及描述）	22
7.1	开户配置系统（邵珠成）	22
7.1.1	子系统接口	22
7.1.2	模块结构	22
7.1.3	基本流程	23
7.2	鉴权系统（白浩亮）	25
7.2.1	子系统接口	25
7.2.2	模块结构	25
7.2.3	基本流程	25
7.3	用户信息系统	26
7.3.1	子系统接口	26
7.3.2	模块结构	27
7.3.3	基本流程	27
7.3.4	终端获取数据流程	27
7.3.5	终端修改数据流程	28
7.4	设备管理系统（黄冰逸）	29
7.4.1	子系统接口	29
7.4.2	模块结构	30
7.4.3	基本流程	30
7.4.3.1	MDM服务登录	30
7.4.3.2	设备权限管理	30
7.4.3.3	应用白名单校验	31
7.4.3.4	设备控制	31
7.5	推送系统（姚君）	31
7.5.1	子系统接口	32
7.5.2	模块结构	32
7.5.3	基本流程	33
7.6	 OTA系统 （黄冬）	34
7.6.1	部署场景结构图：	34
7.6.2	子系统接口	35
7.6.3	模块结构	35
7.6.4	基本流程	37
8	多eUDC解决方案	39
8.1	多eUDC组网方案	39
8.2	子网间组网	39
8.3	子网内组网	40
8.4	数据接口	40
9	安全红线	41
9.1	三面隔离	41
9.2	WEB安全	41
10	可靠性	42
11	性能分析	43
11.1	话务模型及参数基准	43
11.2	CPU处理能力估算	43
11.3	内存估算	43
12	组网设计和约束分析	44
13	参考资料清单	45


TTR6.0 eUDC系统架构设计说明书
关键词：系统规格，逻辑功能，物理部署，硬件基本配置，数据通路，子系统设计分析。
摘  要：本文从eUDC功能需求出发，分别从软件架构、硬件架构、运行架构、关键特性规划，规格参数等不同角度，为eUDC提供一个系统级规格描述。
缩略语清单：.
缩略语	英文全名	中文解释
APS	Application Server	应用服务器
BIN	Binary Interface	二进制接口
DHCP	Dynamic Host Control Protocol	动态主机控制协议
IP	Internet Protocol	Internet协议
LMT	Local Maintenance Terminal	本地维护终端
LTE	Long Term Evolution	长期演进
MAC	Media Access Control	媒体接入控制
MML	Man Machine Language	人机语言
NTP	Network Time Protocol	网络对时协议
OM	Operation & Maintenance	操作维护
OMC	Operation and Maintenance Center	操作维护中心
PTT	Push To Talk	集群语音业务
PTP	Point To Point talk	点呼业务
SIP	Session Initiation Protocol	会话发起协议
SNTP	Simple Network Time Protocol	简单网络对时协议
TCP	Transmission Control Protocol	传输控制协议
TTR	TDD Trunking Radio	TDD无线集群系统
UDP	User Diagram Protocol	用户平面协议
EIR	Equipment Identity Register	设备标识寄存器
MDM	Mobile Device Management	移动设备管理
AAS	Authentication and Authorization Server	认证和授权服务器


1	产品概述
1.1	 名称、型号、版本、保密代号
行业专网TTR 6.0 eUDC主体是基于eAPP软硬件平台开发，开户部分（eBS）和手持终端管理部分继承和移植eOMC已有的设计和实现。
1.2	 业务简述
eUDC是TTR4.0新增网元，继承和移植了TTR3.0 eOMC的开户功能、PUSH Server功能和手持终端管理功能。继承和移植TTR3.0 eMDC的AAS功能，并在此基础上新增终端开户、用户权限管理和终端权限管理等功能。
涉及的业务部分主要功能有：管道层开户、应用层开户、终端设备开户、终端资产管理、终端管理、PUSH Server、AA Server、用户信息和权限管理等等。
底软部分主要功能有：操作系统，传输协议栈，运行平台和模块间通信。
操作维护部分主要功能有：配置、维护、告警、软件管理、日志等功能，这些功能部分需要部署在eUDC的部分进程上。
1.3	 组网与设备独立性
1.3.1	逻辑组网
TTR4.0 eUDC的定位是构建安全接入应用策略平台，特别是从wifi接入的业务，由于没有专网网络的安全保护和隔离，安全接入的重要性更高。
 
图 1.	eUDC逻辑组网
1.3.2	主备和异地容灾组网
eUDC依赖eAPP平台提供主备异地容灾组网，主备和异地容灾方案和eAPP保持一致。TTR3.0 eAPP是基于veritas提供的异地容灾功能，veritas进行主备仲裁和数据同步。该方案存在成本高、数据同步时间太长、出现问题后定位困难等问题，TTR4.0计划对该方案进行优化，采用轻量级主备方案。
eUDC计划采用主备方案实现异地容灾功能，也就是主备方案和异地容灾采用相同的方案，两个eUDC都部署在本地机房就是主备方案，两个eUDC部署在不同地点就是异地容灾方案，不支持同时部署主备和异地容灾方案。基于浮动IP地址切换的主备方案由于涉及浮动IP地址切换，需要主备eUDC之间使用L2组网。
双机可靠性的关键是出现故障后的业务中断时间，现有业务是否中断反而不是最关键的指标，并且eUDC作为接入网元，内存基本没有太多状态机数据，可以采用冷备方案，用户的注册信息写入数据库，利用数据库的备份实现用户注册信息的备份，保证被eUDC恢复后，业务能尽快恢复，尽量减少业务中断时间，降低故障对业务的影响。
eUDC的主备包括三个大部分，包括主备仲裁和切换、数据库备份和文件备份。
 
图 2.	eUDC异地容灾组网

2	产品功能、性能
2.1	功能特性
eUDC定位为开户配置中心及终端安全接入通道，功能特性包括以下六大子系统如下：
	开户配置功能，包括管道层开户、应用层开户、组网配置及用户权限配置  ；
	鉴权功能，认证、鉴权服务器，用于用户和设备的登录鉴权
	推送功能，对终端/客户端提供通知推送的功能；
	OTA功能，终端远端配置、版本下载、日志采集等
	设备管理功能，包括核心网IMEI校验、终端设备管理
	用户信息服务功能，向终端、其它系统提供用户信息、用户权限、用户群组信息的服务
同时，在标准化上，eUDC要支持3GPP、BtrunC和鼎桥Witen三种接口协议。
根据功能和协议，6.0UDC划分成以下服务（只包含拥有对外接口的服务）
	基础配置子系统	鉴权子系统	推送子系统	用户数据子系统	设备管理子系统	OTA子系统
3GPP	--	IDMS	SIP-DB	SIP-AS	UIS	--	--
Witen	EBS	AAS	XMPP		MDM	EIR	OTA
BtrunC	--	--	--	THSS	--	--

2.2	系统对外接口
eUDC相关的对外接口如下：
 
图 3.	eUDC对外系统接口示意图

协议模式	接口名	本端服务	对端系统	协议	说明
3GPP	AAA-1	SIP-DB	SIP Core	Diameter	信令面接口；
SIP-DB向SIP-Core提供信令面所需数据。
参考3GPP TS 23.002 [3]和3GPP TS 23.228 [34].
	CSC-1	IDMS	UE-IDMC	OIDC/HTTPS	应用面接口；
IDMC与IDMS之间，为CSC服务提供应用面鉴权认证
参考3GPP TS 33.179 [13].
	CSC-2	UIS-GMS	UE-GMC	HTTP
SIP	提供GMC和GMS之间的群组数据配置功能
non-subscription/notification使用HTTP
subscription/notification 使用SIP
	CSC-3	UIS-GMS	MCPTT Server	HTTP
SIP	向MCPTT Server提供群组数据
non-subscription/notification使用HTTP
subscription/notification 使用SIP
	CSC-4	UIS-CMS	UE-CMC	HTTP
SIP	提供CMC和CMS之间的非群组数据配置功能
non-subscription/notification使用HTTP
subscription/notification 使用SIP
	CSC-5	UIS-CMS	MCPTT Server	HTTP
SIP	向MCPTT Server提供非群组数据
non-subscription/notification使用HTTP
subscription/notification 使用SIP
	CSC-7	UIS-GMS	GMS	HTTP
SIP	用于多MCPTT系统环境下，GMS之间的群组数据交换
non-subscription/notification使用HTTP
subscription/notification 使用SIP
	CSC-13	UIS-CMS	User-Database	Diameter	用于CMS向User-Database存取用户profile信息
	MCPTT-2	User-Database	MCPTT Server	Diameter	MCPTT Server使用该接口获取用户Profile信息
参考3GPP TS 29.283  [17] 
BtrunC	TC1	THSS	HSS	Diameter	BtrunC标准定义的TCF与HSS之间的接口
	HTTP-W2	THSS	MDC	HTTP	MDC通过该接口修改Btrunc相关的配置数据
Witen	 	EBS	EBS	HTTP	UDC主从、上下级之间的数据同步接口
	EBS-Rest	EBS	CCMD/EGW	RESTful	UDC其它外部系统提供的Rest数据接口
	SOAP	EBS	BOSS	SOAP	UDC其它外部系统提供的SOAP数据接口
	ZMQ	EBS	MDC	ZMQ	UDC向MDC进行数据同步的接口
	CN-MML	EBS	CN	MML	UDC向核心网进行数据同步的接口
	HTTP-W3	UIS	Witen UE	HTTP	UDC向终端提供的用户Profile接口，包括群组、摄像头、通讯录等
	HTTP-W4	AAS	MDC	HTTP	UDC向MDC提供TOKEN校验、用户鉴权等功能接口
	HTTP-W5	AAS	Witen UE	HTTP	UDC向终端提供的终端接入鉴权接口
	HTTP-W6	MDM	Witen UE	HTTP	UDC向终端提供的终端设备管理接口
	HTTP-W7	OTA	Witen UE	HTTP	UDC向终端提供的OTA接口
	CN-Diameter	EIR	CN	Diameter	UDC向核心网提供设备校验接口
	XMPP	PUSH	Witen UE	XMPP	UDC向终端提供推送
	PUSH-REST	PUSH	CCMD/EGW	RESTful	UDC其它外部系统提供的Rest推送接口

3	遵循的标准及主要通信协议
3.1	协议处理原则
eUDC网元对外接口较多，涉及对接的协议较多，协议处理原则是尽量遵循标准的协议，需要考虑可替换性，私有协议也尽量使用主流的协议。
3.2	网络兼容性处理
eUDC需要考虑后续产品版本的兼容性，所以在私有协议的处理上要有很好的兼容性。
4	平台及配置简介（钟卫）
4.1	硬件平台简介
eUDC基于eAPP平台开发，采用和eAPP相同的硬件平台，也是X86服务器，支持DELL和华为的指定几款服务器，硬件平台的具体内容参看平台文档。
4.2	软件平台介绍
eUDC基于eAPP平台开发，采用和eAPP相同的软件平台，采用基于ACE自开发的软件平台。平台子系统为eUDC系统提供了开发，运行，部署，调试，维护与升级的基础平台。平台子系统基于ACE和其他第三方软件、跨平台（支持Linux/Windows），提供面向服务的分布式消息框架，以及基础部件、操作维护等功能。

 
图 4.	eUDC软件平台
4.3	部署策略
eUDC的部署形态比较多，包括独立部署、和eAPP共部署、eBS和eOMC共部署等几种形态，部署的具体策略参见《MDC和UDC共部署特性设计说明书》
5	系统总体结构（钟卫）
5.1	顶层逻辑架构
根据UDC的功能特性，划分成以下六大子系统
 
图 5.	eUDC产品顶层逻辑架构
	开户配置系统：管道层开户、应用层开户以及UDC的统一配置。其包含：前端界面、对外接口、配置服务、组网同步服务、更新通知服务等
	OTA系统：终端OM管理系统，包括终端参数配置、日志采集、新版本下载等功能。其包含：OTA管理客户端、OTA任务管理服务、终端接入服务、文件下载服务
	鉴权系统：提供终端安全接入相关的功能，其包含：Witen终端鉴权、3GPP终端鉴权
	推送系统：提供向终端/客户端发送通知消息
	开户信息系统：向终端、其它系统提供用户信息、群组信息、配置信息的功能，其包含：CMS（3GPP配置管理服务）、GMS（3GPP群组管理服务）、User-Database（3GPP用户信息数据中心）、UIS（Witen用户信息服务）、HSS（BtrunC用户信息服务）
	设备管理系统：包含MDM（终端设备管理）、EIR（核心网IMEI校验）

5.2	子系统间接口设计
子系统间，除了3GPP协议标准定义的接口，其它私有接口在UDC内部采用ZMQ接口通道。各子系统提供的接口有：
接口名称	接口方式	接口提供者	接口功能说明	接口使用者
鉴权接口	ZMQ	鉴权系统	提供用户鉴权、TOKEN校验等接口	OTA系统（可选）、推送系统（可选）、用户信息系统、设备管理系统
推送接口	ZMQ	推送系统	提供消息推送接口	鉴权系统、用户信息系统、设备管理系统
开户数据查询接口	数据库访问	开户配置系统	提供开户数据、配置数据等数据的查询功能	鉴权系统、用户信息系统、设备管理系统
开户数据配置接口	ZMQ	开户配置系统	提供开户数据、配置数据等数据的修改功能	鉴权系统、用户信息系统

5.3	三面隔离部署
由于三面隔离需要，操作维护面、信令面和用户面需要隔离开。按照无线安全PC的理解，终端能访问的属于用户面，并且由于终端的特点，从终端发起的攻击可能会比较多，无线安全PC建议产品支持终端和客户端访问隔离，产品需要支持这个能力。
支持该隔离，需要在WEB Service上进行隔离，可以部署两个WEB Service，客户端和网元间接口使用一个单独的WEB Service，终端使用单独一个WEB Service。另外一个方案是通过不同IP地址进行隔离，WEB Service绑定两个IP地址，一个面向终端，另一个面向客户端或网元，两个IP地址不能互访，WEB Service不能绑定0.0.0.0。
考虑到实现复杂度等原因，eUDC的三面隔离采用基于不同IP地址的隔离方式，通过TOMCAT绑定不同IP，给OM、信令面和用户面提供WEB服务，实现三面隔离。
6	系统部署架构（钟卫）
6.1	子系统结构设计
 
6.2	三栈解决方案设计
6.2.1	Witen解决方案
在Witen解决方案中，UDC与MDC、UE、核心网、网关、云指挥等系统间，采用持鼎桥自定义的Witen协议，UDC相关的服务及接口如下：

 
6.2.2	BtrunC解决方案
在BtrunC解决方案中，需要同时涵盖BtrunC协议栈和自定义的Witen协议栈。所以在此解决方案下，UDC所包括的服务及接口如下：
 
6.2.3	3GPP解决方案
在3GPP解决方案中，需要同时涵盖3GPP协议栈和自定义的Witen协议栈。所以在此解决方案下，UDC所包括的服务及接口如下：
注：经过评估及决策，UDC的SIP-DB、USER-DB功能后来进行了裁剪，不新增进程，AAA鉴权不经过UDC；DB使用业软自己的数据库，MCPPT-2、CSC-3、CSC-5采用私有接口。

   
6.3	进程部署
 
图 6.	eUDC进程部署图
子系统	进程名	功能说明	类型
开户配置系统	udc_web	UDC WEB进程（Tomcat），内置ebs,udi,nbi,api几个WebApp	WEB
	udc_opm	EBS业务进程	JAVA
	udc_med	网元接入适配进程	JAVA
OTA系统	udc_ota	OTA WEB进程，内置ota、otadata、cau几个WebApp；5.1新增进程	WEB
	udc_uom	OTA后台进程	JAVA
鉴权系统	udc_aas	AAS进程	C++
	udc_idms	IDMS服务进程	JAVA
	udc_sipdb	SIP-DB服务进程；5.1新增进程	C++
用户信息系统	udc_uis	UIS进程(6.0与CMS/GMS合并)	C++
	udc_cms	CMS服务进程；5.1新增进程	C++
	udc_gms	GMS服务进程；5.1新增进程	C++
	udc_userdb	UserDatabase服务进程；5.1新增进程	C++
	udc_hss	BtrunC协议支持的HSS代理服务进程	C++
设备管理系统	udc_eir	EIR进程	C++
	udc_mdm	MDM进程	C++
推送系统	udc_push	PUSH进程	JAVA
公共服务	udc_ftp	FTP进程，向ebs和ota提供文件传输服务；	JAVA
	udc_omp	OMP平台进程	JAVA
	udc_tis	aas、uis、mdm的HTTP接入服务	JAVA
6.4	负荷分担部署
eUDC暂不考虑多进程的负荷分担机制，但在实现时与终端接入相关的业务要支持水平扩展，具体负荷分担机制由各子系统实现
7	子系统设计分析（根据钟卫的总体设计，修正下面的子系统章节及描述）
7.1	开户配置系统（邵珠成）
7.1.1	子系统接口
 
图 7.	eBS接口关系图


	eBS —— DC(MDC)： eBS向DC开放的资源访问接口，接口参考《TTR4.0 eAPP和eUDC HTTP接口说明书》
	eBS —— BOSS： eBS向上层管理系统开放的资源访问接口， 接口采用SOAP协议，参考《TTR4.0 CRN06607 SOAP接口定义V1.1》
	eBS ——eGW：eBS向网关开放的资源访问接口，接口采用restful方式。
	eBS——CCMD：eBS向云指挥平台开放的资源访问接口，接口采用restful方式。
	eBS —— MDC：eBS向MDC做配置资源同步的接口，增量同步采用ZMQ，全同步使用FTP文件传输，接口参考《TTR4.0 MDC和UDC配置接口表格》
	eBS —— CN：eBS向核心网做配置资源同步的接口，增量同步采用MML，全同步使用FTP文件传输，接口参考《TTR4.0 核心网与eUDC接口设计说明书》
	eBS —— UDC：UDC之间的配置资源同步接口，增量同步采用HTTPS，全同步使用FTP文件传输
	eBS —— SVN：eBS与本UDC中终端接入子系统间的接口，采用ZMQ通道
	eBS —— OTA：eBS与本UDC中OTA子系统间的接口，采用ZMQ通道
7.1.2	模块结构
下面为eBS子系统内关键模块： 
 
图 8.	eBS模块结构图
说明：
1)	WebUI服务模块，为UDC界面操作，提供各类数据配置和查询功能。
2)	接口服务模块，提供ebs与UDC内部模块、周边网元的接口服务
3)	业务服务模块，为上层webUI和接口服务提供支撑，包括：数据配置和查询、数据更新通知、数据同步等功能
4)	平台服务模块，提供公共组件、进程维护、数据库访问、日志/告警/license与业软平台接口
7.1.3	基本流程
下面为eBS配置处理流程： 


 
图 9.	eBS数据处理流图
说明：
1)	在UDC上，发起一次对数据配置的操作有几个来源：
a)	可以通过WEB浏览器操作，由webUI处理；
b)	UDI接收到调度台（hpgw）发来的配置请求；
c)	NBI接收上级开户系统（如：BOSS）发来的配置请求；
d)	RestAPI接收网关（eGW）和云指挥平台（CCMD）发来的请求；
e)	收到SVN发来的终端侧发起的配置请求。
2)	所有的配置请求经过接口适配（ITF）后传递到数据配置模块（CM）。
3)	配置模块，收到业务请求后，对数据进行校验、前处理并入库、后处理，然后触发数据更新通知（MOTIFY）和数据同步任务。
4)	通知模块（NOTIFY）收到通知任务后，对数据进行解析后，分别发出zmq和http通知。
5)	同步模块（SYNC）收到同步任务后，将数据经过适配层的格式转化后，发给MED；或者通过http同步消息发到从UDC；
6)	MED根据不同网元的通讯协议，将数据推给对应的网元。
7)	从UDC收到数据服务请求后，会将消息转发到主UDI进行数据服务。
7.2	鉴权系统（白浩亮）
鉴权系统包含AAS、IDMS、SIP-DB三个服务，用以支撑Witen和3GPP。模块结构及接口如下：

7.2.1	子系统接口
鉴权系统对外提供的接口有：
接口提供者	接口名称	接口使用者	接口说明
AAS	HTTP-W5	Witen UE	向Witen终端提供的终端接入鉴权接口
AAS	HTTP-W4	MDC、CCMD等外部子系统	
IDMS	CSC1/HTTP	3gpp UE	向符合3gpp接口的终端提供的终端接入鉴权接口
SIP DB	AAA1/DIAMETER	SIP Core	对SIP Core提供向量选择鉴权功能

7.2.2	模块结构
 
7.2.3	基本流程
1 、Witen终端到AAS进行用户和设备鉴权（同5.0）。
2 、对外（UDC内其他模块以及MDC等网元）提供鉴权认证功能（同5.0）。
3、符合3GPP标准终端到IDMS进行鉴权认证。
     
4、基于3GPP标准对SIP Core提供向量鉴权功能。
 
7.3	用户信息系统
  用户信息系统这里简称UIS，提供用户的权限配置服务，通讯录服务，摄像头服务以及群组服务。在witen原有方案中，四种服务类型都在UIS模块中实现。在3GPP方案中，由CMS和GMS服务完成原UIS服务中的用户权限配置服务和群组服务功能，其余服务仍然继承witen的实现（摄像头服务和通讯录服务）。这里仍然采用UIS作为用户信息系统的统称。
1)	用户、群组服务—— 业务必须的
	用户Profile、用户群组列表：属于用户的签约数据。
	群组信息、群组成员列表：群组成员列表供团队多媒体使用。
2)	通讯录服务，摄像头服务—— 提高易用性的，需要时才使用
	企业联系人：所有签约终端用户的联系方式列表；
	摄像头监控列表：所有签约摄像头的列表，类似通讯录的作用，所以把它可以作为企业通讯录服务的一部分，即企业通讯录服务包含：人、固定摄像头，对应不同的接口。

7.3.1	子系统接口
UIS <-> DB服务			读取用户签约数据、用户的群组列表
	读写用户自定义信息
	读取群组信息、群组成员列表
	读取摄像头列表
UIS <-> PUSH	ZMQ接口		给用户推送消息
a)	用户Profile变更
b)	用户的群组列表变更
c)	群组信息变更
d)	群组成员列表变更
UIS <-> MQ	ZMQ接口		订阅eBS的用户、群组、摄像头数据变更消息
a)	收到消息后，再去数据库读取具体的变更内容
b)	收到消息后，结束用户的会话
UIS -> AAS	ZMQ接口	用户服务的token鉴权
7.3.2	模块结构
 
UIS整体架构分成三层：
•	接口层（请求接入层）：根据外部接口基线，适配不同协议的外部接口。包括与UE、DC以及其它子系统的接口
•	应用层（应用服务层）：按功能分成订阅通知服务、同步服务、实时业务服务，其中实时业务服务根据业务不同，分成CMS、GMS、UIS、Auth等逻辑服务
•	数据层：根据数据存储定义DB数据模型，提供对数据CRUD功能，对应用服务屏蔽数据的物理存储（物理存储可根据需要采用Mysql、Redis、内存或XML DB）
7.3.3	基本流程
7.3.4	终端获取数据流程
 
流程说明：
1.	启动：
1.1.	启动时，各数据服务从数据库加载自己所需的数据
2.	订阅：
2.1.	Witen终端在登入时，默认为订阅所有相关数据
2.2.	3GPP终端通过SIPAS的订阅请求订阅指定数据
3.	查询：
3.1.	终端发出查询请求，通过HttpService路由到相应的Controller处理
3.2.	Controller解析请求后，向后端数据服务获取数据
3.3.	Controller将后端数据服务的返回结果按协议格式，转换成对应的XML
4.	更新推送：
4.1.	同步模块接收EBS的ZMQ消息，进行缓冲、批量后，将更新数据转换成UIS数据模型
4.2.	调用相应模型的数据服务，更新数据对象
4.3.	将更新结果发送到Push模块
4.4.	Push模块根据订阅关系，产生对应的推送消息，通过合并、限流后，推送给相应的终端
7.3.5	终端修改数据流程
 
流程说明：
1.	终端发起数据更新上报（如个人名片，当前组）
2.	Controller收到该请求后，转发到后端服务
3.	后端服务调用EBS的数据修改接口，更新该数据
4.	EBS更新完成后，通过异步的ZMQ广播通知给EBS，后面进入上一节中的“更新推送”流程
7.4	设备管理系统（黄冰逸）
MDM（Mobile Device Management ）设备管理系统主要向用户提供终端的设备权限管理，白名单校验（应用白名单、移动接入点白名单、设备IMEI白名单），设备控制（擦除、遥闭、遥开）。
7.4.1	子系统接口
接口提供者	接口使用者	接口类型	接口说明
AAS	MDM	ZMQ	AAS鉴权检查，处理AAS发送的终端设备状态消息（上线/离线）

Udc推送服务	MDM	XMPP	设备权限、擦除、遥开、遥闭消息推送
MDM	UE	HTTPS	白名单检查（应用、移动接入点、设备IMEI），权限下载请求
MDM	AAS	ZMQ	IMSI与IMEI绑定
WEB	MDM		订阅表变更
DB	MDM		查询白名单及其全网参数
查询设备控制状态
查询设备权限

7.4.2	模块结构
 
服务登录模块接受UE的服务登录请求，向AAS模块校验携带的AASToken，校验通过后分配sessionId,携带的pushToken用于后续推送，并将登录结果返回终端。白名单管理子模块接受对应客户端的请求，将校验后的结果返回给客户端。权限管理子模块接受终端请求，返回对应设备权限；订阅WEB表变更，当设备权限变化时，推送消息给PUSH。设备控制模块订阅WEB表变更，推送相应消息给PUSH。

7.4.3	基本流程

7.4.3.1	MDM服务登录
将UE携带的IMEI和aasToken到AAS鉴权，鉴权通过后进行服务登录并返回结果。分配的session用于后续其他服务建立，pushToken用于推送通知。
 
7.4.3.2	设备权限管理
设备权限管理负责维护设备权限表，并且支持下发和查询设备权限。
UE向MDM服务登录成功后，权限管理模块支持UE主动请求设备权限；WEB修改设备权限后，权限管理模块将根据该pushToken向PUSH Server推送设备权限更新通知。
 
7.4.3.3	应用白名单校验
应用白名单可以提供终端应用软件合法性检查，检查内容为软件名，数字签名信息和软件版本。该功能启用后，只有在白名单列表中的终端应用可以向终端授权安装。支持应用白名单的增删改查等管理操作。
 
7.4.3.4	设备控制
订阅表中遥开、遥闭、擦除状态的改变，收到表变更后通过PUSH推送变更通知。MDM服务登录时也会进行锁定、擦除状态的判断。
 
7.5	推送系统（姚君）
推送子系统向UDC内部其他业务子系统及UDC外部的应用（云指挥平台、网关等）提供推送服务。推送子系统对外提供ZMQ接口以及HTTP的Restful接口，以便不同应用根据自身情况选择不同的接口与推送子系统进行通信。
推送子系统包括两个进程，一个进程部署在UDC的Web服务中，用于提供Restful接口，另一个进程udc_push提供ZMQ接口和向终端推送的XMPP接口，Restful和ZMQ两种自定义接口都采用标准化接口，推送子系统不感知具体推送消息类型。TTR5.0中，推送子系统已经实现了可靠性推送相关特性，不再需要业务子系统从上层业务去保证可靠推送。
推送子系统使用XMPP协议向终端进行推送时，使用Openfire组件实现，需要将业务代码从Openfire组件中剥离，以便后续Openfire组件的升级和推送子系统的代码维护。
 
7.5.1	子系统接口
接口提供者	接口交互	协议	接口说明
Web	CCMD/EGW	RESTful	Push子系统向其它外部系统提供的Restful推送接口
udc推送服务	Witen UE	XMPP	Push子系统向终端提供推送
udc_push进程	UDC内部其他子系统	ZMQ	Push子系统向UDC内部其他子系统提供的ZMQ推送接口

7.5.2	模块结构
 
Web：部署在Tomcat中，用于向其它外部系统提供的Restful接口，并将收到的Http消息转化成ZMQ消息发送给udc_push。
udc_push：独立进程，向UDC内部其他子系统提供ZMQ接口，向终端进行推送，对终端进行token管理，提供可靠性推送。
7.5.3	基本流程
终端与udc_push之间注册、注销以及心跳等流程都维持原有实现。
 

UDC的外部系统使用标准化Restful接口，将要发送的内容根据Name及Value对填入消息中，Web模块收到该消息后再将该消息转化为ZMQ消息发送给udc_push模块，由udc_push模块将该ZMQ消息转化为XMPP message后推送给终端。

 
UDC内其他各子系统使用标准化的ZMQ接口，将要发送的内容根据Name及Value对填入消息中，由udc_push模块将该ZMQ消息转化为XMPP message后推送给终端。

7.6	 OTA系统 （黄冬）
7.6.1	部署场景结构图：
 
UOM服务器：
1.	负责任务的管理。
2.	OTA客户端通过RMI与UOM服务器交互。

终端OTA服务器：
1.	负责终端实时业务的处理。
2.	终端通过HTTP协议与终端OTA服务器交互。

OTA数据库：
1.	信任域内使用同一个数据库
2.	不同信任域实现数据库同步

部署场景描述
    场景1：UOM服务器与终端OTA服务器共部署。
    场景2：终端OTA服务器信任域内扩展，通过部署多台OTA服务器，负载均衡终端实时业务，提升实时业务并发量。
场景3：终端OTA服务器跨网闸扩展，需要ZMQ消息，ftp文件传输，数据库数据同步实现穿网闸操作。
5.1版本实现场景1。
7.6.2	子系统接口
接口提供者	接口交互	协议	接口说明
UOM服务器	OTA客户端->UOM服务器	RMI	提供任务相关服务
UOM服务器	OTA客户端->UOM服务器	ftp	提供ftp服务上传文件
UOM服务器，
终端OTA服务器	终端OTA服务器<->UOM服务器	ZMQ	ZMQ消息通信
（穿网闸场景需要ZMQ消息穿网闸）
UOM服务器，
终端OTA服务器	终端OTA服务器<->UOM服务器	ftp	同步文件
（穿网闸场景需要ftp传输穿网闸）
UOM服务器	UOM服务器->OTA数据库	JDBC	读写相关任务表
终端OTA服务器	终端->终端OTA服务器	HTTP	终端实时业务
终端OTA服务器	终端OTA服务器->OTA数据库	JDBC	读写终端信息表，读相关任务表信息
OTA数据库	OTA数据库-> OTA数据库	sql dump	OTA相关表同步，需要实现穿网闸(需要平台支持)
7.6.3	模块结构   
  
OTA客户端:
OTA 客户端，包括报表管理，文件管理，任务管理，日志上传，配置查询与修改等。

UDC_UOM:
OTA任务管理模块，服务器udc_uom进程;
向OTA客户端提供RMI服务，主要负责任务的管理;

OTA_DB:
    OTA数据库模块;

UDC_OTA:
    终端实时业务模块,服务器udc_ota进程;
 	 处理终端的http请求，主要负责终端用户的接入管理;

OTA_DATA:
    终端文件下载模块,服务器udc_ota进程;
	 处理终端http请求，主要负责任务文件下载;	 

CAU:
	 客户端下载模块,服务器udc_ota进程;
    处理http请求,主要负责OTA客户端安装包下载;


7.6.4	基本流程
1.	终端注册流程：
服务化前流程：
 

服务化后流程:
 
   
2.	任务push流程：
OTA服务化前流程：
 

OTA服务化后流程：
 

3.	任务pull流程：
OTA服务化前流程：
 
OTA服务化后流程：
 
8	多eUDC解决方案
8.1	多eUDC组网方案
eUDC在TTR4.0版本中有固网分布式、主/从车等多种组网场景，同时考虑到项目上的多级组网，eUDC在5.0后的组网模型如下：
 
图 10.	多eUDC组网
其中包括子网间组网以及子网内组网两种形态。
8.2	子网间组网
为满足项目的分级组网管理及互联互通的需求，eUDC提供多子网的部署形态。具体设计参考《TTR5.0 分布式组网增强方案0层设计说明书》
子网定义：子网是Witen网络中的一部分或全部（当一个网络全部由一个子网组成时），其具有LTE业务开展必须具有的网元，在网元间建立必要的连接，从而在子网内可独立提供无线LTE业务。
子网间的关系包括：
	上-下级组网关系：表示两子网存在上下级的关系；
	上级对外展现的号段涵盖其下级子网的号段；
	在上下级双方协定后，上级子网可接管下级子网的开户功能；
	上、下级之间可实现开户数据的同步；
	平级组网关系
	平级组网之间只为实现用户的业务互通而设置
	平级组网之间不支持开户数据同步
8.3	子网内组网
基于子网内，可能存在多种网络形态，服务器之间的传输并不稳定。需要提供一种终端能够近端接入的部署形态。因此从部署上，将eUDC分成主、从两种逻辑形态：
主eUDC：
	包括eBS，SVN，OTA，下接1~N个MDC
	拥有开户、终端接入、组网管理等子网的完整功能
	每个子网中只能有唯一一个主eUDC
从eUDC：
	包括eBS，SVN，OTA（可选），下接1~N个MDC
	仅提供终端的近端接入、业务功能，不具备开户、组网等运营管理功能
	每个子网中可以有多个从eUDC
	每个从eUDC的数据从主eUDC中同步过来，范围为主eUDC的子集或全集

而且根据每个eUDC的部署位置，又可分成固网和车两种物理形态。

基于项目上的多种组合，则可形成多种部署形态：
	固网主eUDC （即固网分布式场景）
	固网主eUDC+从车UDC（即固网+车场景）
	主车eUDC+从车eUDC（即车组网场景）
	固网主eUDC+固网从UDC（即固网穿网闸场景）

8.4	数据接口
基于上述的子网间、子网内的多种组网形态，UDC涉及的数据接口有：
1)	子网间的eUDC同步： 上下子网中的主eBS互连，完成上下级子网的开户数据的同步； 
2)	主从eBS同步：子网内主、从eBS互连，完成开户数据的同步
3)	eBS向MDC同步：eBS将开户数据同步给下挂的MDC
4)	SVN/OTA就近访问其所在的主/从eBS数据
9	安全红线
TTR5.0 eUDC的安全红线较多，除各个特性都需要考虑安全红线外，还有几个比较大的安全红线需求，主要有三面隔离、WEB安全等等，其它安全需求参见威胁分析。
9.1	三面隔离
eUDC的开户和OM等功能可以认为是传统的OM面，eUDC的终端连接和访问功能可以认为是传统的用户面，按照华为安全要求，这两个面需要做隔离，也就是终端无法访问到eUDC的开户和OM等功能。
eUDC的开户和OM等WEB功能和对手持终端提供的WEB功能使用使用不同的IP地址，这些IP地址缺省是不可以相互访问的。
9.2	WEB安全
TTR5.0 WEB应用比较多，B/S架构的可攻击点特别多，安全需求很多，该改动需要完全遵循华为的WEB安全规范《Web应用安全开发规范 V2.0》，主要的该需求如下：
	服务端校验必须完毕，C/S架构下可以在客户端做校验，客户端校验通过后服务端可以不再做校验，但是B/S架构下，服务端校验必须是完毕的，客户端校验只是用于提升操作体验，不能代替服务端校验；
	WEB攻击类防范，主要包括跨站脚本攻击（XSS）、跨站点请求伪造（CSRF）等，主要方法是做输入校验和输出编码；
	安全相关的日志记录，按照安全红线要求，所有安全类操作都需要记录安全日志，包括各种登录失败的场景，B/S架构下，可以方便伪造各种安全失败场景，如URL越权等等，安全相关的日志记录需要完毕；
10	可靠性
TTR5.0 eUDC可靠性指标要求系统可用度>99.999%，参考以下可靠性基线：
电信软件业务部可靠性基线5.0.1.xls
电信软件业务部可靠性基线V3.1.0.doc
11	性能分析
11.1	话务模型及参数基准
暂缺，待补充。
11.2	CPU处理能力估算
暂缺，待补充。
11.3	内存估算
暂缺，待补充。
12	组网设计和约束分析
基于主备的异地容灾方案由于使用浮动IP地址切换，需要使用L2组网。具体组网设计参见解决方案组网设计文档。
13	参考资料清单
[1]	
[2]	

